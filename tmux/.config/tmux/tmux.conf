#Prefix is Ctrl-a
set -g prefix C-a
bind -r C-a send-prefix
unbind C-b
set -g status-position top

# Increase tmux messages display duration from 750ms to 4s
set -g display-time 2000
# Refresh 'status-left' and 'status-right' more often, from every 15s to 5s
set -g status-interval 1
# Upgrade $TERM
set -g default-terminal "screen-256color"

set -sg escape-time 0
set -g base-index 1
setw -g pane-base-index 1

# Mouse works as expected
set -g mouse on
# do not clear selection on mouse dragend
unbind -T copy-mode-vi MouseDragEnd1Pane
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-selection-no-clear

set -g mode-keys vi
set -g history-limit 10000

# Reload config
bind-key R source-file ~/.config/tmux/tmux.conf \; \
        display-message "source-file done"

# Easier and faster switching between next/prev window
bind C-p previous-window
bind C-n next-window
unbind \;
bind \; last-window
# last session
bind-key Space switch-client -l
bind-key C-Space switch-client -l
# easy-to-remember split pane commands
bind | split-window -h
bind _ split-window -v
unbind '"'
unbind %
# moving between panes with vim movement keys
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R
# resize panes with vim movement keys
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# clipboard sync wayland
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "wl-copy && wl-paste -n | wl-copy -p"
bind-key p run "wl-paste -n | tmux load-buffer - ; tmux paste-buffer"
# y and p as in vim
unbind Escape
unbind ] # paste
bind [ copy-mode
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'y' send -X copy-selection
bind-key -T copy-mode-vi 'Space' send -X halfpage-down
bind-key -T copy-mode-vi 'Bspace' send -X halfpage-up

# exit copy mode with i 
bind -T copy-mode-vi i send -X cancel

# tmux sessionizer
bind f display-popup -E "tms"
bind s display-popup -E "tms switch"

# pomodoro
# set -g @pomodoro_prompt_break "#[fg=$color_green]☕"
# ☕ 05:00 [1/4]  ← During break
set -g @pomodoro_toggle 'O'                    # Start/pause a Pomodoro/break
set -g @pomodoro_skip ']'                      # Skip a Pomodoro/break
# set -g @pomodoro_cancel '-'                    # Cancel the current session
set -g @pomodoro_mins 30                       # The duration of the Pomodoro
set -g @pomodoro_break_mins 5                  # The duration of the break after the Pomodoro completes
set -g @pomodoro_intervals 4                   # The number of intervals before a longer break is started
set -g @pomodoro_long_break_mins 15            # The duration of the long break
set -g @pomodoro_repeat 'off'                  # Automatically repeat the Pomodoros?
set -g @pomodoro_disable_breaks 'off'          # Turn off breaks
set -g @pomodoro_notifications 'on'           # Enable desktop notifications from your terminal
set -g @pomodoro_granularity 'on'             # Enables MM:SS (ex: 00:10) format instead of the default (ex: 1m)
set -g @pomodoro_interval_display "[%s/%s]"   # Shows current interval / total intervals
set -g @pomodoro_sound 'on'                   # (On Linux add `on` to use the `beep` program or add your custom beeping command)

# Make the status line pretty and add some modules
set -g @catppuccin_flavor "mocha"
set -g @catppuccin_window_status_style "rounded"

# Last 2 directories
set -g @catppuccin_window_text " #(basename $(dirname '#{pane_current_path}')||echo '')/#{b:pane_current_path}"
set -g @catppuccin_window_current_text " #(basename $(dirname '#{pane_current_path}')||echo '')/#{b:pane_current_path}"

# Load catppuccin
run ~/.config/tmux/plugins/tmux/catppuccin.tmux

set -g status-right-length 100
set -g status-left-length 100
set -g status-left ""
set -agF status-left "#{E:@catppuccin_status_pomodoro_plus}"
set -g status-right "#[fg=default,bg=default] %I:%M %p "
set -ag status-right "#{E:@catppuccin_status_session}"
set -ag status-right "#{E:@catppuccin_status_application}"
set -agF status-right "#{E:@catppuccin_status_battery}"
set -ag status-right "#[fg=default,bg=default] #{user}@#{host_short}:#(ip route get 1.1.1.1 | awk '{print $7}' | head -1) "


# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'catppuccin/tmux#v2.1.3' # See https://github.com/catppuccin/tmux/tags for additional tags
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'olimorris/tmux-pomodoro-plus'

# set -g @plugin 'tmux-plugins/tmux-resurrect'

# Automatic plugin manager installation
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
